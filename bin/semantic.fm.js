var fm={acts:{},list:{},log:{},message:{},nop:function(){},noact:function(a,c,d){a(d)},true:function(a,c,d){a(!0===d)},false:function(a,c,d){a(!1===d)},if:function(a,c,d){return function(b,e,f){a(function(a){a?c(b,e,f):"function"===typeof d?d(b,e,f):b(f)},e,f)}},or:function(a){var c=Array.prototype.slice.call(arguments);return function(a,b,e){function f(g){if("function"===typeof c[g])c[g](function(b){b?a(!0):f(++g)},b,e);else a(!1)}f(0)}},and:function(a){var c=Array.prototype.slice.call(arguments);
return function(a,b,e){function f(h){if("function"===typeof c[h])c[h](function(b){b?(g+=1,f(++h)):a(!1)},b,e);else a(g===c.length)}var g=0;f(0)}},check:function(a,c){return function(d,b,e){a(function(a){a?d(e):c(e)},b,e)}},while:function(a,c){return function(d,b,e){function f(b,d,e){fm.acts.fold([fm.check(a,b),c])(function(a){f(b,d,a)},d,e)}f(d,b,e)}},transact:function(a,c){function d(a,d){b+=1;a()}var b=0;return function(e,f,g){fm.acts.wrap(a,d)(e,function(){fm.acts.foldLimit(c,b)(f,f,null)},g)}},
script:function(a){return fm.acts.fold(a)},map:function(a){return fm.list.fold(a,[])},each:function(a){return fm.list.walk(a)},reduce:function(a,c){return fm.list.fold(a,c)},filter:function(a){return fm.list.filter(a)},async:function(a){return function(c,d,b){a(b);c(b)}},createAccumulator:function(a){return a instanceof Array?new fm.list.Accumulator(a):new fm.Accumulator(a)},not:function(a){return function(c,d,b){a(function(a){a?c(!1):c(!0)},d,b)}}};fm.IAccumulator=function(){};fm.IAccumulator.prototype.get=function(){};fm.IAccumulator.prototype.update=function(a){};fm.IIterator=function(){};fm.IIterator.prototype.hasNext=function(){};fm.IIterator.prototype.next=function(){};fm.IIterator.prototype.destroy=function(){};fm.Accumulator=function(a){this.__data=a};fm.Accumulator.prototype.get=function(){return this.__data};fm.Accumulator.prototype.update=function(a){this.__data=a};fm.list.Accumulator=function(a){this.__list=a||[]};fm.list.Accumulator.prototype.get=function(){return this.__list};fm.list.Accumulator.prototype.update=function(a){this.__list.push(a)};fm.list.Iterator=function(a){this.__list=a;this.__position=-1};fm.list.Iterator.prototype.hasNext=function(){return"undefined"!==typeof this.__list[this.__position+1]};fm.list.Iterator.prototype.next=function(){return this.__list[++this.__position]};fm.list.Iterator.prototype.destroy=function(){this.__list=null;this.__position=-1};fm.list.walk=function(a){return function(c,d,b){function e(){if(f.hasNext()){var g=f.next();a(e,d,g)}else f.destroy(),c(b)}var f=new fm.list.Iterator(b);e()}};fm.list.fold=function(a,c){return function(d,b,e){function f(a){k.update(a);g()}function g(){if(h.hasNext()){var c=h.next();a(c,f,b)}else h.destroy(),d(k.get())}var h=new fm.list.Iterator(e),k=fm.createAccumulator(c);g()}};
fm.list.filter=function(a){return function(c,d,b){function e(b){a(function(a){a&&h.update(b);f()},d,b)}function f(){g.hasNext()?e(g.next()):(g.destroy(),c(h.get()))}var g=new fm.list.Iterator(b),h=new fm.list.Accumulator;f()}};fm.list.fork=function(a){return function(c,d,b){d=0;for(var e=a.length;d<e;)b(fm.nop,fm.nop,a[d]),d+=1;c(a)}};fm.acts.fold=function(a){return function(c,d,b){function e(a){a(f,d,k.get())}function f(a){k.update(a);g(h,k,e)}function g(a,b,d){a.hasNext()?d(a.next()):c(b.get())}var h=new fm.list.Iterator(a),k=new fm.Accumulator(b);g(h,k,e)}};fm.acts.foldLimit=function(a,c){return function(d,b,e){function f(a){a(g,b,m.get())}function g(a){m.update(a);k+=1;h(l,m,f)}function h(a,b,e){a.hasNext()&&k<c?e(a.next()):d(b.get())}var k=0,l=new fm.list.Iterator(a),m=new fm.Accumulator(e);h(l,m,f)}};
fm.acts.fork=function(a){return function(c,d,b){d=0;for(var e=a.length;d<e;)a[d](fm.nop,fm.nop,b),d+=1;c(b)}};fm.acts.wrap=function(a,c){return function(d,b,e){function f(a){a(g,b,l.get())}function g(a){l.update(a);c(function(){h(k,l,f)},b,l.get())}function h(a,b,c){a.hasNext()?c(a.next()):d(b.get())}var k=new fm.list.Iterator(a),l=new fm.Accumulator(e);h(k,l,f)}};fm.log.message=function(a){return function(c,d,b){console.log(a);c(b)}};fm.log.input=function(a){return function(c,d,b){console.log("[fm.log] ",a,JSON.stringify(b));c(b)}};fm.log.expand=function(a){return function(c,d,b){console.log("[fm.log] ",a,b);c(b)}};module.exports = fm;

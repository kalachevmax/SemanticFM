var fm={acts:{},list:{},log:{},message:{},nop:function(){},noact:function(a,d,c){a(c)},true:function(a,d,c){a(!0===c)},false:function(a,d,c){a(!1===c)},if:function(a,d,c){return function(b,e,f){a(function(a){a?d(b,e,f):"function"===typeof c?c(b,e,f):b(f)},e,f)}},or:function(a){var d=Array.prototype.slice.call(arguments);return function(a,b,e){function f(g){if("function"===typeof d[g])d[g](function(b){b?a(!0):f(++g)},b,e);else a(!1)}f(0)}},and:function(a){var d=Array.prototype.slice.call(arguments);
return function(a,b,e){function f(h){if("function"===typeof d[h])d[h](function(b){b?(g+=1,f(++h)):a(!1)},b,e);else a(g===d.length)}var g=0;f(0)}},check:function(a,d){return function(c,b,e){a(function(a){a?c(e):d(e)},b,e)}},while:function(a,d){return function(c,b,e){function f(b,c,e){fm.acts.fold([fm.check(a,b),d])(function(a){f(b,c,a)},c,e)}f(c,b,e)}},transact:function(a,d){function c(a,c){b+=1;a()}var b=0;return function(e,f,g){fm.acts.wrap(a,c)(e,function(){fm.acts.foldLimit(d,b)(f,f,null)},g)}},
script:function(a){return fm.acts.fold(a)},map:function(a){return fm.list.fold(a,[])},each:function(a){return fm.list.walk(a)},reduce:function(a,d){return fm.list.fold(a,d)},filter:function(a){return fm.list.filter(a)},async:function(a){return function(d,c,b){a(b);d(b)}},createAccumulator:function(a){return a instanceof Array?new fm.list.Accumulator(a):new fm.Accumulator(a)}};module&&module.exports&&(module.exports=fm);fm.IAccumulator=function(){};fm.IAccumulator.prototype.get=function(){};fm.IAccumulator.prototype.update=function(a){};fm.IIterator=function(){};fm.IIterator.prototype.hasNext=function(){};fm.IIterator.prototype.next=function(){};fm.IIterator.prototype.destroy=function(){};fm.Accumulator=function(a){this.__data=a};fm.Accumulator.prototype.get=function(){return this.__data};fm.Accumulator.prototype.update=function(a){this.__data=a};fm.list.Accumulator=function(a){this.__list=a||[]};fm.list.Accumulator.prototype.get=function(){return this.__list};fm.list.Accumulator.prototype.update=function(a){this.__list.push(a)};fm.list.Iterator=function(a){this.__list=a;this.__position=-1};fm.list.Iterator.prototype.hasNext=function(){return"undefined"!==typeof this.__list[this.__position+1]};fm.list.Iterator.prototype.next=function(){return this.__list[++this.__position]};fm.list.Iterator.prototype.destroy=function(){this.__list=null;this.__position=-1};fm.list.walk=function(a){return function(d,c,b){function e(){if(f.hasNext()){var g=f.next();a(e,c,g)}else f.destroy(),d(b)}var f=new fm.list.Iterator(b);e()}};fm.list.fold=function(a,d){return function(c,b,e){function f(a){k.update(a);g()}function g(){if(h.hasNext()){var d=h.next();a(d,f,b)}else h.destroy(),c(k.get())}var h=new fm.list.Iterator(e),k=fm.createAccumulator(d);g()}};
fm.list.filter=function(a){return function(d,c,b){function e(b){a(function(a){a&&h.update(b);f()},c,b)}function f(){g.hasNext()?e(g.next()):(g.destroy(),d(h.get()))}var g=new fm.list.Iterator(b),h=new fm.list.Accumulator;f()}};fm.list.fork=function(a){return function(d,c,b){c=0;for(var e=a.length;c<e;)b(fm.nop,fm.nop,a[c]),c+=1;d(a)}};fm.acts.fold=function(a){return function(d,c,b){function e(a){a(f,c,k.get())}function f(a){k.update(a);g(h,k,e)}function g(a,b,c){a.hasNext()?c(a.next()):d(b.get())}var h=new fm.list.Iterator(a),k=new fm.Accumulator(b);g(h,k,e)}};fm.acts.foldLimit=function(a,d){return function(c,b,e){function f(a){a(g,b,m.get())}function g(a){m.update(a);k+=1;h(l,m,f)}function h(a,b,e){a.hasNext()&&k<d?e(a.next()):c(b.get())}var k=0,l=new fm.list.Iterator(a),m=new fm.Accumulator(e);h(l,m,f)}};
fm.acts.fork=function(a){return function(d,c,b){c=0;for(var e=a.length;c<e;)a[c](fm.nop,fm.nop,b),c+=1;d(b)}};fm.acts.wrap=function(a,d){return function(c,b,e){function f(a){a(g,b,l.get())}function g(a){l.update(a);d(function(){h(k,l,f)},b,l.get())}function h(a,b,d){a.hasNext()?d(a.next()):c(b.get())}var k=new fm.list.Iterator(a),l=new fm.Accumulator(e);h(k,l,f)}};fm.log.message=function(a){return function(d,c,b){console.log(a);d(b)}};fm.log.input=function(a){return function(d,c,b){console.log("[fm.log] ",a,JSON.stringify(b));d(b)}};fm.log.expand=function(a){return function(d,c,b){console.log("[fm.log] ",a,b);d(b)}};
